<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>Common Tool</title>
    <!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html" />
    <![endif]-->
    <link href="../../css/plugins/jQueryUI/jquery-ui.min.css" rel="stylesheet" />
    <link href="../../css/plugins/bootstrap/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/plugins/font-awesome/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet" />
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/plugins/toastr/toastr.min.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/plugins/bootstrapTable/bootstrap-table.min.css" rel="stylesheet" />
    <link href="../../css/plugins/bootswatch/bootstrap.min.default.css" rel="stylesheet" />
    <link href="../../css/plugins/bootstrapDateTimePicker/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <style type="text/css">
        .ui-autocomplete {
            max-height: 100px;
            overflow-y: auto;
            /* 防止水平滚动条 */
            overflow-x: hidden;
            z-index: 99999999;
        }

        /* IE 6 不支持 max-height
         * 我们使用 height 代替，但是这会强制菜单总是显示为那个高度
         */
        * html .ui-autocomplete {
            height: 100px;
        }

        body .mes-layer-title .layui-layer-title {
            color: #fff;
            background-color: #337ab7;
        }
    </style>
</head>

<body class="color-cPage gray-bg">
    <div class="ibox full-height">
        <!--<div class="panel-heading bg-primary">-->
        <!--<h3>
            <i class="glyphicon glyphicon-tags"></i><span style="padding-left:10px;"
                                                          set-lan="html:Configuration">Configuration</span>
        </h3>-->
        <!--</div>-->
        <div class="ibox-content">
            <div class="col-lg-12">
                <div class="col-lg-6">
                    <div class="panel panel-success col-xs-12 no-padding">
                        <div class="panel-heading" style=" font-size:small; margin-bottom:10px;font-weight:bold;text-shadow: black 5px 3px 3px; font-size: 17px"
                             set-lan="html:Operation">
                            Operation
                        </div>
                        <div class="row full-height full-height">
                            <div class="panel-body col-lg-5" style="margin-left: 10px;">
                                <div id="DivFun">
                                    <div>
                                        <Label>
                                            <lan set-lan="html:function"> Function:</lan>
                                        </Label>
                                        <select type="text" id="StrFun" class="form-control col-lg-12">
                                            <option value="0">Reverse DOF WO</option>
                                            <option value="1">Reverse DOF SN</option>
                                            <option value="2">Reture MA Station</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="DivSku">
                                    <Label>
                                        <lan set-lan="html:sku"> SkuNo:</lan>
                                    </Label>
                                    <input type="text" ID="strSku" class="form-control col-lg-12" />
                                </div>
                                <div id="DivWO">
                                    <Label>
                                        <lan set-lan="html:wo"> Wo:</lan>
                                    </Label>
                                    <input type="text" ID="strWo" class="form-control col-lg-12" />
                                </div>
                                <div id="DivSN">
                                    <Label>
                                        <lan set-lan="html:sn"> Sn:</lan>
                                    </Label>
                                    <input type="text" ID="strSn" AutoPostback="true"  class="form-control col-lg-12" />
                                </div>
                                <div id="DivStation">
                                    <Label>
                                        <lan set-lan="html:Date"> Station:</lan>
                                    </Label>
                                    <div>
                                        <select id="Station" class="form-control" name="Station"></select>
                                    </div>
                                </div>
                                <div>
                                    <Label>
                                        <lan set-lan="html:Action"> Action:</lan>
                                    </Label>
                                    <div>
                                        <input type="button" ID="btnSubmit" value="Submit" style="background-color: #337ab7; color: white; text-shadow: black 5px 3px 3px; font-size: 15px" class="form-control col-lg-6" />
                                    </div>
                                    <div>
                                        <input type="button" ID="btnReset" value="Reset" style="background-color: #337ab7; color: white; text-shadow: black 5px 3px 3px; font-size: 15px" class="form-control  col-lg-6 " />
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-1" id="DivRadio">
                                <div class="form-group">
                                    <br />
                                    <br />
                                    <Label id="LbSelect">
                                        IsTrue?<input type="checkbox" ID="IsTrue" class="radio radio-inline">
                                    </Label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-success col-xs-12 no-padding">
                        <div class="panel-heading" style="font-size: small; font-weight: bold; text-shadow: black 5px 3px 3px; font-size: 17px"
                             set-lan="html:Message">Message</div>
                        <div class="panel-body no-padding pre-scrollable" id="messagesite">
                        </div>
                    </div>
                </div>
                <div class="col-xs-6">
                    <div class="panel panel-success col-xs-12 no-padding">
                        <div class="panel-heading" style=" font-size: small; margin-bottom: 10px; font-weight: bold; text-shadow: black 5px 3px 3px; font-size: 17px"
                             set-lan="html:Operation">Information</div>
                        <div class="row full-height">
                            <div class="panel-body col-xs-12" style="margin-left: 20px;">
                                <table id="tableList" class="table table-bordered"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 全局js -->
    <script src="../../Scripts/plugins/jquery/jquery.min.js"></script>
    <script src="../../Scripts/plugins/jquery/jquery.cookie.js"></script>
    <script src="../../Scripts/plugins/bootstrap/bootstrap.min.js?v=3.3.6"></script>
    <!-- 第三方插件 -->
    <script src="../../Scripts/plugins/jquery-ui/jquery-ui.js"></script>
    <script src="../../Scripts/plugins/JSON/json2.js"></script>
    <script src="../../Scripts/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="../../Scripts/plugins/toastr/toastr.min.js"></script>
    <script src="../../Scripts/plugins/layer/layer.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapDateTimePicker/bootstrap-datetimepicker.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapDateTimePicker/bootstrap-datetimepicker.zh-CN.js"></script>
    <!-- 自定义 -->
    <script src="../../Scripts/global.js"></script>
    <script src="../../Scripts/MesClient.js"></script>
    <script src="../../Scripts/MesClient.UI.js"></script>
    <script>
        var lan = $.cookie($.MES.CK_LAN_NAME);
        $(document).ready(function () {
            if (lan == "CHINESE") {
                tableLocale = "zh-CN"
            }
            else if (lan == "CHINESE_TW") {
                tableLocale = "zh-TW"
            }
            else {
                tableLocale = "en"
            };
            $("#DateFrom").datetimepicker({
                format: 'yyyy-mm-dd',//选择年月日時分秒
                language: 'zh-CN',
                autoclose: true,
                todayHighlight: true,
                startView: 2,
                minView: 2
            });

            $("#DateTo").datetimepicker({
                format: 'yyyy-mm-dd',//选择年月日時分秒
                language: 'zh-CN',
                autoclose: true,
                todayHighlight: true,
                startView: 2,
                minView: 2
            });

            var ShowTable = function (data) {
                $("#tableList").bootstrapTable("destroy");
                $("#tableList").bootstrapTable({
                    //ajax: ajaxRequest,
                    data: data,
                    striped: true,                    //是否显示行间隔色
                    cache: false,                      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    sortable: false,                   //是否启用排序
                    sortOrder: "asc",                  //排序方式
                    pagination: false,                  //是否显示分页（*）
                    sidePagination: "server",          //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                     //初始化加载第一页，默认第一页
                    pageSize: 500,                      //每页的记录行数（*）
                    pageList: [500, 1000],               //可供选择的每页的行数（*）
                    showColumns: false,                 //是否显示 内容列下拉框
                    showRefresh: false,                 //是否显示刷新按钮
                    clickToSelect: false,               //是否启用点击选中行
                    singleSelect: false,                //单选checkbox
                    showToggle: false,                  //是否显示详细视图和列表视图的切换按钮
                    cardView: false,                   //是否显示详细视图
                    detailView: false,                 //是否显示父子表
                    search: false,
                    strictSearch: false,               //设置为 true启用 全匹配搜索，否则为模糊搜索
                    searchOnEnterKey: false,            //回车搜索
                    searchTimeOut: 500,                //设置搜索超时时间
                    trimOnSearch: true,                //设置为 true 将允许空字符搜索
                    //searchAlign: "left",              //查询框对齐方式
                    //toolbar: "#tableEventsToolbar",    //指定工具栏
                    //toolbarAlign: "left",              //工具栏对齐方式
                    //buttonsAlign: "left",             //按钮对齐方式
                    showExport: false,                  //是否显示导出按钮
                    exportDataType: 'all',             //'basic', 'all', 'selected'  exportDataType表示导出的模式是当前页、所有数据还是选中数据
                    exportTypes: ['excel', 'csv'],     //导出文件类型
                    Icons: 'glyphicon-export',
                    locale: lan,
                    exportOptions: {
                        ignoreColumn: [0],             //忽略某一列的索引
                        fileName: 'List',              //文件名称设置
                        worksheetName: 'sheet1',       //表格工作区名称
                    },
                    rowStyle: function (row, index) {
                        switch (row.STATUS) {
                            case "PASS":
                                return { css: { 'color': '#00FF00' } };
                                break;
                            case "FAIL":
                                return { css: { 'color': '#ff0000' } };
                                break;
                            default:
                                return "";
                                break;
                        }
                    },
                    columns: [
                        { field: "DATA1", title: "WO", align: 'center', valign: 'middle', visible: false },
                        { field: "DATA2", title: "QTY", align: 'center', valign: 'middle' },
                        { field: "LOG_MESSAGE", title: "Remark", align: 'center', valign: 'middle' },
                        { field: "EDIT_EMP", title: "EDIT_EMP", align: 'center', valign: 'middle' },
                        { field: "EDIT_TIME", title: "EDIT_TIME", align: 'center', valign: 'middle' },
                        {
                            field: "MODIFY", title: "MODIFY", align: 'center', valign: 'middle',
                            formatter: function (value, row, index) {
                                return ['<button id="btnModify" type="button" class="btn btn-success" ><i class="glyphicon glyphicon-trash" aria-hidden="true" style="display:inline"></i><lan set-lan="html:"></lan></button >'].join('');
                            },
                            events: ColumnBtnClick
                        }]
                });
                $("lan:contains('Export Data')").parent().css({ 'border-top-left-radius': '0', 'border-bottom-left-radius': '0' });
            }

            $("#strSn").keydown(function (event) {
                if (event.keyCode == 13) {
                    var E = new MessageElements();
                    var Function = $("#StrFun").val();
                    var Sn = $("#strSn").val();
                    if (Function == "2") {
                        self.parent.client.CallFunction("MESStation.Management.CommonTool", "SnStatusFlagChecker_Tool", { SN: Sn }, function (e) {
                            if (e.Status == "Pass") {
                                ShowTable(e.Data);
                                E.Default(Message = e.Message, State = 6, $("#messagesite"));
                            }
                            else {
                                E.Default(Message = e.Message, State = 0, $("#messagesite"));
                                return;
                            }
                        });
                        self.parent.client.CallFunction("MESStation.Management.CommonTool", "GetStationBySnDataloader_Tool", { SN: Sn }, function (e) {
                            var sel = $("#Station");
                            sel.empty();
                            if (e.Status == "Pass") {
                                var temp = e.Data;
                                E.Default(Message = e.Message, State = 6, $("#messagesite"));
                                $.each(e.Data, function (index, station) {
                                    sel.append("<option value='" + station + "'>" + station + "</option>");
                                });
                            } else {
                                E.Default(Message = e.Message, State = 0, $("#messagesite"));
                            }
                        });
                    }
                }
            });

            $("#DivFun").change(function (e) {
                var Function = $("#StrFun").val();
                switch (Function) {
                    case "0":
                        $("#DivSku").addClass("hidden");
                        $("#DivWO").removeClass("hidden");
                        $("#DivSN").addClass("hidden");
                        $("#DivDate").addClass("hidden");
                        $("#DivRadio").addClass("hidden");
                        $("#DivStation").addClass("hidden");
                        return;
                    case "1":
                        $("#DivSku").addClass("hidden");
                        $("#DivWO").addClass("hidden");
                        $("#DivSN").removeClass("hidden");
                        $("#DivDate").addClass("hidden");
                        $("#DivRadio").addClass("hidden");
                        $("#DivStation").addClass("hidden");
                        return;
                    case "2":
                        $("#DivSku").addClass("hidden");
                        $("#DivWO").addClass("hidden");
                        $("#DivSN").removeClass("hidden");
                        $("#DivDate").addClass("hidden");
                        $("#DivRadio").addClass("hidden");
                        $("#DivStation").removeClass("hidden");
                        return;
                    default:
                        return;
                }
            });

            $("#btnSubmit").on("click", function () {
                var E = new MessageElements();
                var FunctionValue = $("#StrFun").val();
                var Station = $("#Station").val();
                switch (FunctionValue) {
                    case "0":
                        self.parent.client.CallFunction("MESStation.Management.Reverse", "ReverseWO", { "WO": $("#strWo").val() }, function (e) {
                            if (e.Status == "Pass") {
                                E.Default(Message = e.Message, State = 6, $("#messagesite"));
                            }
                            else {
                                E.Default(Message = e.Message, State = 0, $("#messagesite"));
                            }
                        });
                        return;
                    case "1":
                        self.parent.client.CallFunction("MESStation.Management.Reverse", "ReverseSN", { "SN": $("#strSn").val() }, function (e) {
                            if (e.Status == "Pass") {
                                E.Default(Message = e.Message, State = 6, $("#messagesite"));
                            }
                            else {
                                E.Default(Message = e.Message, State = 0, $("#messagesite"));
                            }
                        });
                        return;
                    case "2":
                        self.parent.client.CallFunction("MESStation.Stations.StationActions.ActionRunners.SNActions", "ReturnSNAction_Tool", { "SN": $("#strSn").val(), "STATION": Station}, function (e) {
                            if (e.Status == "Pass") {
                                ShowTable(e.Data);
                                E.Default(Message = e.Message, State = 6, $("#messagesite"));
                            }
                            else {
                                E.Default(Message = e.Message, State = 0, $("#messagesite"));
                            }
                        });
                        return;
                    default:
                        return;
                }
            });

            $("#btnReset").click(function () {
                var cancelMessage;
                if (lan == "CHINESE") {
                    cancelMessage = "取消输入";
                }
                else if (lan == "CHINESE_TW") {
                    cancelMessage = "取消輸入";
                }
                else {
                    cancelMessage = "Cancel Input";
                };
                $("#strWo").val("");
                $("#strSn").val("");
                $("#strSku").val("");
                var E = new MessageElements();
                $("#messagesite").push(E);
                E.Default(Message = cancelMessage, State = 2, $("#messagesite"));
            });

            window.ColumnBtnClick = {
                'click .btnModify': function (e, value, row, index) {
                    self.parent.client.CallFunction("MESStation.Config.CSkuSampleConfig", "RemoveOrt", { ID: row.ID, SN: row.SN, STATUS: row.STATUS }, function (e) {
                        if (e.Status == "Pass") {
                            E.Default(Message = e.Message, State = 6, $("#messagesite"));
                        }
                        else {
                            E.Default(Message = e.Message, State = 2, $("#messagesite"));
                        }
                    })
                }
            };

            var MessageElements = function () {
                MessageElements.prototype.Default = function (Message, State, Container) {
                    var DTime = new Date();
                    var time = DTime.format("yyyy-MM-dd hh:mm:ss");
                    var type = State == 0 ? "error" : (State == 1 || State == 6 ? "success" : (State == 2 ? "info" : (State == 3 ? "warning" : "info")));
                    if (Container.find) {
                        if (Container.find("tbody").length > 0) {
                            Container.find("tbody>tr:gt(200)").remove();
                            var n = Container.find("tbody>tr:first>td:first").text();
                            var tr = $("<tr class=\"" + type + "\"><td>" + (Number(n) + 1).toString() + "</td><td>" + type + "</td><td>" + Message + "</td><td>" + time + "</td></tr>");
                            Container.find("tbody").prepend(tr);
                        }
                        else {
                            var table = $("<table class=\"table table-striped\"></table>");
                            var th = $("<thead><tr><th>#</th><th>Type</th><th>Message</th><th>DataTime</th></tr></thead>");
                            var tb = $("<tbody></tbody>");
                            var tr = $("<tr class=\"" + type + "\"><td>1</td><td>" + type + "</td><td>" + Message + "</td><td>" + time + "</td></tr>");
                            tb.append(tr);
                            table.append(th);
                            table.append(tb);
                            Container.empty();
                            Container.prepend(table);
                        }
                    }
                };
            };

        });

    </script>

</body>

</html>