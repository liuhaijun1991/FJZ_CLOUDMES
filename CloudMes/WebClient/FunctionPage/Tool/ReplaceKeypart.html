<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <title set-lan="html:Title">Replace Keypart</title>
    <meta charset="utf-8">
    <meta name="author" content="fgg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../../css/plugins/bootstrap/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/plugins/font-awesome/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet" />
    <link href="../../css/plugins/bootstrapTable/bootstrap-table.min.css" rel="stylesheet" />
    <link href="../../css/plugins/bootstrapDateTimePicker/bootstrap-datetimepicker.min.css" rel="stylesheet" />

    <style type="text/css">
        .div-table-tool {
            float: left;
            padding: 0px;
            margin: 0px;
        }
        /*去掉表格自定義工具按鈕最後一個右上、右下圓角*/
        #tableEventsToolbar .btn:last-child {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .new-pallet-title {
            background-color: #007bff !important;
            color: white !important;
            font-size: larger;
            font-weight: bold;
        }
        .tr-background-color {
            background-color: Highlight !important;
        }
    </style>
</head>
<body class="animated fadeInRight">
    <div id="divFilterCondition" class="row form-horizontal" style="margin-top:10px;">
        <div class="col-xs-3">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right">SN:</label>
                <div class="col-xs-9">
                    <input type="text" class="form-control" id="inputSN" />
                </div>
            </div>
        </div>
        <div class="col-xs-1">
            <button type="button" class="btn btn-outline btn-default" id="btnSearch">
                <i class="glyphicon glyphicon-search" aria-hidden="true"></i><lan set-lan="html:Search">Search</lan>
            </button>
        </div>
    </div>
    <div id="divListDetail" class="row col-xs-12" style="margin-left:5px;">
        <div class="bootstrap-table">
            <div class="fixed-table-toolbar">
               
            </div>
            <table id="tableList" class="table table-hover"></table>
        </div>
    </div>
    <div id="divEdit" class="form-horizontal" style="padding-top:20px;display:none">
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">SN</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_sn" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">KP_NAME</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_kp_name" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">MPN</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_mpn" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">SCANTYPE</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_scantype" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">PARTNO</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_partno" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">VALUE</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_value" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">ReturnStation</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_return_station" readonly="readonly" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">New PARTNO</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_new_partno" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">New MPN</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_new_mpn" />
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-3 control-label text-right" set-lan="html:">New VALUE</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control" id="edit_new_value" />
                </div>
            </div>
        </div>
    </div>
    <!-- 全局js -->
    <script src="../../Scripts/plugins/jquery/jquery.min.js?v=2.1.4"></script>
    <script src="../../Scripts/plugins/jquery/jquery.cookie.js"></script>
    <script src="../../Scripts/plugins/bootstrap/bootstrap.min.js?v=3.3.6"></script>
    <script src="../../Scripts/plugins/JSON/json2.js"></script>
    <!-- 第三方插件 -->
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table-export.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/tableExport.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table-zh-CN.min.js"></script>
    <script src="../../Scripts/plugins/bootstrapTable/bootstrap-table-zh-TW.min.js"></script>
    <script src="../../Scripts/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="../../Scripts/plugins/layer/layer.min.js"></script>
    <!-- 自定義插件 -->
    <script src="../../Scripts/global.js"></script>
    <script src="../../Scripts/MesClient.UI.js"></script>
    <script type="text/javascript">
        var tableLocale;
        window.ColumnBtnClick = {
            'click #btnReplace': function (e, value, row, index) {
                ShowEditDiv(row);
            }
        }
        var ShowList = function (tableID, data, tableLocale) {
            $("#" + tableID).bootstrapTable("destroy");
            $("#" + tableID).bootstrapTable({
                data: data,
                striped: false,                    //是否显示行间隔色
                cache: false,                      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                sortable: false,                   //是否启用排序
                sortOrder: "asc",                  //排序方式
                pagination: true,                  //是否显示分页（*）
                sidePagination: "client",          //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                     //初始化加载第一页，默认第一页
                pageSize: 10,                       //每页的记录行数（*）
                pageList: [10, 20, 60, 100],        //可供选择的每页的行数（*）
                showColumns: false,                 //是否显示 内容列下拉框
                showRefresh: false,                 //是否显示刷新按钮
                minimumCountColumns: 2,            //最少允许的列数
                clickToSelect: true,               //是否启用点击选中行
                singleSelect: true,                //单选checkbox
                showToggle: false,                  //是否显示详细视图和列表视图的切换按钮
                cardView: false,                   //是否显示详细视图
                detailView: false,                 //是否显示父子表
                search: true,                      //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，
                strictSearch: false,               //设置为 true启用 全匹配搜索，否则为模糊搜索
                searchOnEnterKey: false,            //回车搜索
                searchTimeOut: 500,                //设置搜索超时时间
                trimOnSearch: true,                //设置为 true 将允许空字符搜索
                searchAlign: "left",              //查询框对齐方式
                toolbar: "#tableEventsToolbar",    //指定工具栏
                toolbarAlign: "left",              //工具栏对齐方式
                buttonsAlign: "left",             //按钮对齐方式
                showExport: true,                  //是否显示导出按钮
                exportDataType: 'all',             //'basic', 'all', 'selected'  exportDataType表示导出的模式是当前页、所有数据还是选中数据
                exportTypes: ['excel', 'csv'],     //导出文件类型
                Icons: 'glyphicon-export',
                exportOptions: {
                    ignoreColumn: [0],             //忽略某一列的索引
                    fileName: 'List',     //文件名称设置
                    worksheetName: 'sheet1',       //表格工作区名称
                },
                locale: tableLocale,
                onDblClickRow: function (row, element) {
                    TableRowDoubleClick(row, element);
                },
                columns: [
                    //{ checkbox: true, align: 'center', valign: 'middle' },
                    {
                        field: 'ID',
                        title: 'ID',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: false
                    },
                    {
                        field: 'SN',
                        title: 'SN',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: 'VALUE',
                        title: 'VALUE',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: 'PARTNO',
                        title: 'PARTNO',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: 'KP_NAME',
                        title: 'KP_NAME',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: 'MPN',
                        title: 'MPN',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: 'SCANTYPE',
                        title: 'SCANTYPE',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: 'STATION',
                        title: 'STATION',
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true
                    },
                    {
                        field: "ACTION",
                        title: "ACTION",
                        align: 'center',
                        valign: 'middle',
                        sortable: false,
                        visible: true,
                        formatter: function (value, row, index) {
                            return ['<button id="btnReplace" type="button" class="btn btn-default" >Replace</button >'].join('');
                        },
                        events: ColumnBtnClick
                    }      
                ]
            });
            //$("lan:contains('Export Data')").parent().css({ 'border-top-left-radius': '0', 'border-bottom-left-radius': '0' });
        }
        var GetKeypartList = function () {
            var sn = $("#inputSN").val();
            parent.client.CallFunction("MESStation.KeyPart.KPScan", "GetSNAllKeypart", { SN: sn }, function (e) {
                $("#tableEventsToolbar").removeClass("tableEventsToolbar-margin-top");
                if (e.Status == "Pass") {
                    ShowList("tableList", e.Data, tableLocale);
                }
                else {
                    ShowList("tableList", [], tableLocale);
                    layer.msg(e.Message, {
                        icon: 2,
                        time: 60000,
                        title: 'ERROR',
                        btn: ['OK']
                    }, function () { });
                }
            });
        }
        var TableRowDoubleClick = function (row, element) {           
            ShowEditDiv(row);
        }
        var ShowEditDiv = function (row) {
            var sn = $("#inputSN").val();
            layer.open({
                id: "EditDiv",
                type: 1,
                shade: 0.8,
                shadeClose: false,
                title: "Replace " + sn+" Keypart",
                area: ['60%', '60%'],
                content: $("#divEdit"),
                offset: "30px",
                btn: ["Save", "Cancel"],
                success: function (layero, index) {
                    $("#edit_return_station").val("");
                    $(".layui-layer-title").addClass("new-pallet-title");
                    parent.client.CallFunction("MESStation.KeyPart.KPScan", "GetReplaceReturnStation", { SN: sn, ROW_KP: row }, function (e) {
                        if (e.Status == "Pass") {
                            $("#edit_return_station").val(e.Data);
                            $("#edit_sn").val(row.SN);
                            $("#edit_kp_name").val(row.KP_NAME);
                            $("#edit_mpn").val(row.MPN);
                            $("#edit_scantype").val(row.SCANTYPE);
                            $("#edit_partno").val(row.PARTNO);
                            $("#edit_value").val(row.VALUE);
                            $("#edit_new_partno").val("").select().focus();
                            $("#edit_new_value").val("");
                            $("#edit_new_mpn").val("");
                        }
                        else {
                            layer.msg(e.Message, {
                                icon: 2,
                                time: 60000,
                                title: 'ERROR',
                                btn: ['OK']
                            }, function () { });
                        }
                    });                    
                },
                end: function () {                   
                },
                yes: function (index) {                   
                    var input_data = {
                        ID: row.ID,
                        NEW_PARTNO: $("#edit_new_partno").val(),
                        NEW_VALUE: $("#edit_new_value").val(),
                        NEW_MPN: $("#edit_new_mpn").val(),
                        SN:sn,
                        RETURN_STATION: $("#edit_return_station").val()
                    };

                    parent.client.CallFunction("MESStation.KeyPart.KPScan", "ReplaceSNKeypart", input_data, function (e) {
                        $("#tableEventsToolbar").removeClass("tableEventsToolbar-margin-top");
                        if (e.Status == "Pass") {
                            layer.close(index);
                            GetKeypartList();    
                        }
                        else {                           
                            layer.msg(e.Message, {
                                icon: 2,
                                time: 60000,
                                title: 'ERROR',
                                btn: ['OK']
                            }, function () { });
                        }
                    });
                },
                cancel: function (index) {
                    layer.close(index);
                    GetKeypartList();                   
                }
            });
        }
        $(document).ready(function () {
            $("#inputSN").val("").select().focus();
            $("#inputSN").bind("keypress", function (e) {
                if (e.keyCode == 13) {
                    GetKeypartList();
                }
            });
            $("#btnSearch").click(function () {
                GetKeypartList();
            });           
        });
    </script>
</body>
</html>